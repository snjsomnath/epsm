Subject: SAML Metadata Updated - Certificate Usage Fixed

Hi Björn,

Thank you for your feedback on the SAML metadata configuration. I've implemented the changes you recommended.

## Changes Applied

✅ **Certificate Usage Fixed**
- Removed `use="signing"` attribute from KeyDescriptor elements
- Certificate can now be used for both signing AND encryption
- As per your suggestion: "If you can remove 'use="signing"' it will be used for both signing and encryption"

✅ **SHA1 Algorithms Removed**
- Removed all SHA1 digest and signing method advertisements
- Only stronger algorithms (SHA256, SHA384, SHA512) are now advertised
- Removed RIPEMD160 as well

## Updated Metadata

The updated metadata is now live at:
**https://epsm.chalmers.se/saml/metadata/**

You can verify the changes:
```bash
curl -s https://epsm.chalmers.se/saml/metadata/ | grep "KeyDescriptor"
# Result: <ns0:KeyDescriptor> (no 'use' attribute)

curl -s https://epsm.chalmers.se/saml/metadata/ | grep -i "sha1"
# Result: (empty - no SHA1 references)
```

## IdP Metadata Refresh

You mentioned that the IdP re-reads metadata once per night. Since we've now fixed the certificate usage issue, could you please:

1. **Confirm the new metadata looks correct** from the IdP perspective
2. **Manually refresh the IdP metadata cache** if possible (to avoid waiting 24 hours)
3. **Let me know when it's safe to test** the SAML login flow again

## Previous Authentication Error

The "Authentication Error / Access Denied" at `/saml/acs/` was likely caused by:
- IdP expecting encryption capability but finding only `use="signing"`
- Certificate mismatch due to stale IdP metadata cache

With the updated metadata and IdP refresh, this should be resolved.

## Technical Details

If you're interested, the implementation uses a custom metadata view that:
1. Generates standard SAML metadata using pysaml2
2. Post-processes the XML to remove `use` attributes from KeyDescriptor
3. Filters out weak algorithms (SHA1, RIPEMD160)
4. Returns clean metadata to the IdP

## Next Steps

Once you confirm the metadata looks good and refresh the IdP cache, I'll test:
1. Login flow (SP-initiated)
2. User attribute mapping
3. Single Logout (SLO)
4. Session persistence

Please let me know if you need any additional information or if there are any other issues with the metadata.

Best regards,
Sanjay Somanath
Chalmers University of Technology
Department of Architecture and Civil Engineering
sanjay.somanath@chalmers.se

---

**Technical Contact:** Sanjay Somanath (sanjay.somanath@chalmers.se)
**Administrative Contact:** Alexander Hollberg (alexander.hollberg@chalmers.se)
**SP Entity ID:** https://epsm.chalmers.se/saml/metadata/
**ACS URL:** https://epsm.chalmers.se/saml/acs/
**SLS URL:** https://epsm.chalmers.se/saml/sls/
