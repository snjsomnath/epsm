# ============================================
# EPSM Production Environment Template
# ============================================
# 
# This file is a TEMPLATE for production deployment.
# Actual secrets are injected from GitHub Secrets during deployment.
# 
# DO NOT put real secrets in this file!
# This file CAN be committed to git safely.
#
# Deploy location: /opt/epsm/.env.production.template
# Used by: .github/workflows/deploy-production.yml
# ============================================

# ============================================
# Django Core Settings
# ============================================
DEBUG=False
DJANGO_SETTINGS_MODULE=config.settings.production
DJANGO_SECRET_KEY=${DJANGO_SECRET_KEY}
ALLOWED_HOSTS=epsm.ita.chalmers.se,epsm-staging.ita.chalmers.se,backend
CSRF_TRUSTED_ORIGINS=https://epsm.ita.chalmers.se
SECRET_KEY=${DJANGO_SECRET_KEY}

# ============================================
# Main Application Database (Single Database)
# ============================================
DB_NAME=epsm_db
DB_USER=epsm_user
DB_PASSWORD=${DB_PASSWORD}
DB_HOST=database
DB_PORT=5432

# ============================================
# PostgreSQL Container Settings
# ============================================
POSTGRES_DB=epsm_db
POSTGRES_USER=epsm_user
POSTGRES_PASSWORD=${DB_PASSWORD}

# ============================================
# Redis Cache & Celery Broker
# ============================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=${REDIS_PASSWORD}
REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
CELERY_BROKER_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
CELERY_RESULT_BACKEND=redis://:${REDIS_PASSWORD}@redis:6379/0

# ============================================
# CORS Configuration
# ============================================
CORS_ALLOWED_ORIGINS=https://epsm.ita.chalmers.se
CORS_ALLOW_CREDENTIALS=True

# ============================================
# EnergyPlus Simulation Configuration
# ============================================
ENERGYPLUS_DOCKER_IMAGE=nrel/energyplus:23.2.0
SIMULATION_TIMEOUT=600
MAX_CONCURRENT_SIMULATIONS=4
DOCKER_GID=999
HOST_MEDIA_ROOT=/opt/epsm/backend/media

# ============================================
# Frontend Build Configuration
# ============================================
VITE_API_BASE_URL=https://epsm.ita.chalmers.se
VITE_WS_URL=wss://epsm.ita.chalmers.se/ws
NODE_ENV=production

# ============================================
# Email Configuration (Chalmers SMTP)
# ============================================
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.chalmers.se
EMAIL_PORT=587
EMAIL_HOST_USER=epsm@chalmers.se
EMAIL_HOST_PASSWORD=${EMAIL_HOST_PASSWORD}
EMAIL_USE_TLS=True
DEFAULT_FROM_EMAIL=epsm@chalmers.se
SERVER_EMAIL=epsm@chalmers.se

# ============================================
# SAML Single Sign-On (Chalmers)
# ============================================
SAML_ENABLED=True
SAML_IDP_METADATA_URL=${SAML_IDP_METADATA_URL}
SAML_ENTITY_CATEGORY=http://refeds.org/category/personalized
SAML_SUPERUSER_WHITELIST=ssanjay,hollberg
SAML_SP_ENTITY_ID=https://epsm.ita.chalmers.se/saml/metadata/
SAML_ACS_URL=https://epsm.ita.chalmers.se/saml/acs/

# ============================================
# SSL/TLS Security Settings
# ============================================
SECURE_SSL_REDIRECT=True
SECURE_PROXY_SSL_HEADER=HTTP_X_FORWARDED_PROTO,https
SESSION_COOKIE_SECURE=True
CSRF_COOKIE_SECURE=True
SECURE_HSTS_SECONDS=31536000
SECURE_HSTS_INCLUDE_SUBDOMAINS=True
SECURE_HSTS_PRELOAD=True
SECURE_CONTENT_TYPE_NOSNIFF=True
SECURE_BROWSER_XSS_FILTER=True
X_FRAME_OPTIONS=DENY

# ============================================
# Session Configuration
# ============================================
SESSION_COOKIE_AGE=86400
SESSION_SAVE_EVERY_REQUEST=False
SESSION_COOKIE_HTTPONLY=True
SESSION_COOKIE_SAMESITE=Lax

# ============================================
# Static and Media Files
# ============================================
STATIC_URL=/static/
STATIC_ROOT=/app/staticfiles
MEDIA_URL=/media/
MEDIA_ROOT=/app/media

# ============================================
# Logging Configuration
# ============================================
LOG_LEVEL=INFO
DJANGO_LOG_LEVEL=INFO

# ============================================
# Monitoring and Error Tracking
# ============================================
SENTRY_DSN=
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1

# ============================================
# Backup Configuration
# ============================================
BACKUP_DIR=/opt/epsm/backups
BACKUP_RETENTION_DAYS=30
DATABASE_BACKUP_ENABLED=True

# ============================================
# Celery Worker Configuration
# ============================================
CELERY_TASK_ALWAYS_EAGER=False
CELERY_TASK_EAGER_PROPAGATES=False
CELERY_ACCEPT_CONTENT=json
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_TIMEZONE=Europe/Stockholm
CELERY_ENABLE_UTC=True

# ============================================
# Application Versioning
# ============================================
VERSION=0.2.2
BUILD_DATE=2025-01-13

# ============================================
# Docker Compose Configuration
# ============================================
COMPOSE_PROJECT_NAME=epsm_prod
COMPOSE_FILE=docker-compose.production.yml

# ============================================
# Performance Tuning
# ============================================
GUNICORN_WORKERS=4
GUNICORN_THREADS=2
GUNICORN_TIMEOUT=120
GUNICORN_MAX_REQUESTS=1000
GUNICORN_MAX_REQUESTS_JITTER=50

# ============================================
# Database Connection Pooling
# ============================================
DB_CONN_MAX_AGE=600
DB_CONN_HEALTH_CHECKS=True

# ============================================
# Placeholder Variables (Injected by GitHub Actions)
# ============================================
# The following variables are replaced during deployment:
# - ${DJANGO_SECRET_KEY} → From GitHub Secret PROD_DJANGO_SECRET_KEY
# - ${DB_PASSWORD} → From GitHub Secret PROD_DB_PASSWORD
# - ${MATERIALS_DB_PASSWORD} → From GitHub Secret PROD_MATERIALS_DB_PASSWORD
# - ${RESULTS_DB_PASSWORD} → From GitHub Secret PROD_RESULTS_DB_PASSWORD
# - ${REDIS_PASSWORD} → From GitHub Secret PROD_REDIS_PASSWORD
# - ${EMAIL_HOST_PASSWORD} → From GitHub Secret PROD_EMAIL_HOST_PASSWORD
# - ${SAML_IDP_METADATA_URL} → From GitHub Secret PROD_SAML_IDP_METADATA_URL
